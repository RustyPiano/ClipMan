# ClipMan æ›´æ–°åŠŸèƒ½è¯´æ˜

## åŠŸèƒ½æ¦‚è¿°

ClipMan ç°å·²é›†æˆ Tauri è‡ªåŠ¨æ›´æ–°åŠŸèƒ½ï¼Œæ”¯æŒï¼š
- æ£€æŸ¥ GitHub Release ä¸Šçš„æœ€æ–°ç‰ˆæœ¬
- æ˜¾ç¤ºæ›´æ–°å†…å®¹å’Œç‰ˆæœ¬ä¿¡æ¯
- ä¸€é”®ä¸‹è½½å¹¶å®‰è£…æ›´æ–°
- æ›´æ–°å®Œæˆåè‡ªåŠ¨é‡å¯åº”ç”¨

## å·²å®ç°çš„åŠŸèƒ½

### 1. åç«¯ (Rust)

**æ–‡ä»¶**: `src-tauri/Cargo.toml`
- æ·»åŠ äº† `tauri-plugin-updater = "2.1"` ä¾èµ–

**æ–‡ä»¶**: `src-tauri/tauri.conf.json`
- é…ç½®äº† updater æ’ä»¶ï¼š
  ```json
  "updater": {
    "active": true,
    "pubkey": "",
    "endpoints": [
      "https://api.github.com/repos/{{owner}}/{{repo}}/releases/latest"
    ],
    "dialog": false
  }
  ```

**æ–‡ä»¶**: `src-tauri/src/main.rs`
- æ·»åŠ äº†ä¸¤ä¸ªæ–°çš„ Tauri å‘½ä»¤ï¼š
  - `check_for_updates()`: æ£€æŸ¥æ›´æ–°
  - `install_update()`: ä¸‹è½½å¹¶å®‰è£…æ›´æ–°
- æ³¨å†Œäº† updater æ’ä»¶

### 2. å‰ç«¯ (Svelte)

**æ–‡ä»¶**: `package.json`
- æ·»åŠ äº† `@tauri-apps/plugin-updater` ä¾èµ–

**æ–‡ä»¶**: `src/routes/settings/+page.svelte`
- åœ¨è®¾ç½®é¡µé¢æ·»åŠ äº†"å…³äºå’Œæ›´æ–°"éƒ¨åˆ†
- UI ç»„ä»¶åŒ…æ‹¬ï¼š
  - å½“å‰ç‰ˆæœ¬æ˜¾ç¤º
  - æ£€æŸ¥æ›´æ–°æŒ‰é’®
  - å®‰è£…æ›´æ–°æŒ‰é’®ï¼ˆæœ‰æ–°ç‰ˆæœ¬æ—¶æ˜¾ç¤ºï¼‰
  - æ›´æ–°å†…å®¹æ˜¾ç¤º
  - çŠ¶æ€æ¶ˆæ¯æç¤º

## ä½¿ç”¨æ–¹æ³•

### ç”¨æˆ·ä½¿ç”¨æµç¨‹

1. æ‰“å¼€ ClipMan è®¾ç½®é¡µé¢ï¼ˆé€šè¿‡æ‰˜ç›˜èœå•æˆ–å¿«æ·é”®ï¼‰
2. æ»šåŠ¨åˆ°"å…³äºå’Œæ›´æ–°"éƒ¨åˆ†
3. ç‚¹å‡»"ğŸ” æ£€æŸ¥æ›´æ–°"æŒ‰é’®
4. å¦‚æœæœ‰æ–°ç‰ˆæœ¬ï¼š
   - ä¼šæ˜¾ç¤ºæœ€æ–°ç‰ˆæœ¬å·
   - æ˜¾ç¤ºæ›´æ–°å†…å®¹
   - æ˜¾ç¤º"â¬‡ï¸ å®‰è£…æ›´æ–°"æŒ‰é’®
5. ç‚¹å‡»"å®‰è£…æ›´æ–°"æŒ‰é’®ï¼š
   - å¼€å§‹ä¸‹è½½æ›´æ–°
   - ä¸‹è½½å®Œæˆåè‡ªåŠ¨å®‰è£…
   - åº”ç”¨è‡ªåŠ¨é‡å¯

### å‘å¸ƒæ–°ç‰ˆæœ¬çš„æµç¨‹

#### 1. æ›´æ–°ç‰ˆæœ¬å·

åœ¨ä»¥ä¸‹æ–‡ä»¶ä¸­æ›´æ–°ç‰ˆæœ¬å·ï¼š
- `src-tauri/Cargo.toml` ä¸­çš„ `version`
- `src-tauri/tauri.conf.json` ä¸­çš„ `version`
- `package.json` ä¸­çš„ `version`

#### 2. æ„å»ºåº”ç”¨

```bash
npm run build
npm run tauri build
```

è¿™ä¼šç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼ˆWindows ç¤ºä¾‹ï¼‰ï¼š
- `src-tauri/target/release/bundle/msi/ClipMan_1.0.0_x64_en-US.msi`
- `src-tauri/target/release/bundle/msi/ClipMan_1.0.0_x64_en-US.msi.zip`
- `src-tauri/target/release/bundle/msi/ClipMan_1.0.0_x64_en-US.msi.zip.sig`

#### 3. åˆ›å»º GitHub Release

1. åœ¨ GitHub ä¸Šåˆ›å»ºæ–°çš„ Releaseï¼ˆå¦‚ `v1.0.1`ï¼‰
2. ä¸Šä¼ æ„å»ºçš„å®‰è£…åŒ…æ–‡ä»¶ï¼š
   - MSI å®‰è£…åŒ…ï¼ˆWindowsï¼‰
   - DMG æ–‡ä»¶ï¼ˆmacOSï¼‰
   - AppImage/debï¼ˆLinuxï¼‰
3. å¡«å†™ Release Notesï¼ˆä¼šæ˜¾ç¤ºåœ¨æ›´æ–°ç•Œé¢ä¸­ï¼‰
4. å‘å¸ƒ Release

#### 4. ç­¾åé…ç½®ï¼ˆå¯é€‰ï¼Œæ¨èç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼‰

ä¸ºäº†å®‰å…¨æ€§ï¼Œå»ºè®®é…ç½®æ›´æ–°ç­¾åï¼š

1. ç”Ÿæˆå¯†é’¥å¯¹ï¼š
```bash
npm run tauri signer generate -- -w ~/.tauri/myapp.key
```

2. æ›´æ–° `tauri.conf.json`ï¼š
```json
"updater": {
  "active": true,
  "pubkey": "YOUR_PUBLIC_KEY_HERE",
  ...
}
```

3. æ„å»ºæ—¶ä¼šè‡ªåŠ¨ä½¿ç”¨ç§é’¥ç­¾å

## é…ç½®è¯´æ˜

### updater é…ç½®é¡¹

- `active`: æ˜¯å¦å¯ç”¨æ›´æ–°åŠŸèƒ½
- `pubkey`: å…¬é’¥ï¼ˆç”¨äºéªŒè¯æ›´æ–°åŒ…ç­¾åï¼‰
- `endpoints`: æ›´æ–°æ£€æŸ¥çš„ç«¯ç‚¹åˆ—è¡¨
  - ä½¿ç”¨ GitHub Releases API
  - `{{owner}}` å’Œ `{{repo}}` ä¼šè‡ªåŠ¨æ›¿æ¢
- `dialog`: æ˜¯å¦ä½¿ç”¨å†…ç½®å¯¹è¯æ¡†ï¼ˆfalse è¡¨ç¤ºä½¿ç”¨è‡ªå®šä¹‰ UIï¼‰

### è‡ªå®šä¹‰æ›´æ–°ç«¯ç‚¹

å¦‚æœä¸ä½¿ç”¨ GitHubï¼Œå¯ä»¥é…ç½®è‡ªå·±çš„æ›´æ–°æœåŠ¡å™¨ï¼š

```json
"endpoints": [
  "https://your-update-server.com/api/releases/{{target}}/{{current_version}}"
]
```

è¿”å›çš„ JSON æ ¼å¼åº”ç¬¦åˆ Tauri updater è§„èŒƒã€‚

## æµ‹è¯•

### å¼€å‘ç¯å¢ƒæµ‹è¯•

1. ä¿®æ”¹ç‰ˆæœ¬å·ä¸ºè¾ƒä½ç‰ˆæœ¬ï¼ˆå¦‚ 0.9.0ï¼‰
2. åœ¨ GitHub ä¸Šåˆ›å»ºä¸€ä¸ªæ›´é«˜ç‰ˆæœ¬çš„ Releaseï¼ˆå¦‚ 1.0.0ï¼‰
3. è¿è¡Œåº”ç”¨å¹¶æ£€æŸ¥æ›´æ–°
4. éªŒè¯æ›´æ–°æµç¨‹

### æ³¨æ„äº‹é¡¹

- å¼€å‘æ¨¡å¼ï¼ˆ`npm run tauri dev`ï¼‰ä¸‹æ›´æ–°åŠŸèƒ½å¯èƒ½ä¸å®Œå…¨å¯ç”¨
- å»ºè®®åœ¨æ‰“åŒ…åçš„åº”ç”¨ä¸­æµ‹è¯•æ›´æ–°åŠŸèƒ½
- ç¡®ä¿ GitHub Release ä¸­åŒ…å«æ­£ç¡®çš„å¹³å°åŒ…

## æ•…éšœæ’é™¤

### æ£€æŸ¥æ›´æ–°å¤±è´¥

1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. ç¡®è®¤ GitHub API å¯è®¿é—®
3. æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—ï¼ˆå¼€å‘å·¥å…·ï¼‰
4. æ£€æŸ¥ `tauri.conf.json` ä¸­çš„ endpoint é…ç½®

### ä¸‹è½½å¤±è´¥

1. æ£€æŸ¥ Release ä¸­æ˜¯å¦åŒ…å«å¯¹åº”å¹³å°çš„å®‰è£…åŒ…
2. ç¡®è®¤æ–‡ä»¶åæ ¼å¼æ­£ç¡®
3. æ£€æŸ¥ç½‘ç»œç¨³å®šæ€§

### å®‰è£…å¤±è´¥

1. æ£€æŸ¥åº”ç”¨æƒé™
2. ç¡®è®¤å®‰è£…åŒ…å®Œæ•´æ€§
3. æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—

## æœªæ¥æ”¹è¿›

- [ ] æ·»åŠ è‡ªåŠ¨æ£€æŸ¥æ›´æ–°ï¼ˆå¯åŠ¨æ—¶ï¼‰
- [ ] æ·»åŠ ä¸‹è½½è¿›åº¦æ¡
- [ ] æ”¯æŒå¢é‡æ›´æ–°
- [ ] æ·»åŠ æ›´æ–°å†å²è®°å½•
- [ ] æ”¯æŒè·³è¿‡ç‰¹å®šç‰ˆæœ¬
- [ ] æ·»åŠ å¼ºåˆ¶æ›´æ–°æœºåˆ¶

## ç›¸å…³æ–‡æ¡£

- [Tauri Updater å®˜æ–¹æ–‡æ¡£](https://tauri.app/v1/guides/distribution/updater/)
- [GitHub Releases API](https://docs.github.com/en/rest/releases)
